/*!
 * pastpresentfuture - Where have we been? Where are we going?
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/PastPresentFuture
 * @version 0.1.6
 */

!function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Util",["jquery"],function(r){return e(t,r)}):"object"==typeof exports?module.exports=e(t,require("jquery")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.Util=e(t,t.jQuery))}(window,function(t,e){"use strict";function r(){var e=t.history;return null!==e.state?e.state.url:t.location.href}function n(t){var e=document.createElement("a");return e.href=t,e.href}function i(){return t.history&&t.history.pushState&&t.history.replaceState?"dynamic":"traditional"}function u(){var r=t.history.state||{};if(!1 in r)return 0;if(e.isNumeric(r.scrollTarget))return r.scrollTarget;var n=e(r.scrollTarget);return n.length?n.first().offset().top:0}function a(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8226;":"•","&#8230;":"…"};for(var r in e)e.hasOwnProperty(r)&&(t=t.replace(new RegExp(r,"g"),e[r]));document.title=t}return{currentStateUrl:r,getAbsoluteUrl:n,getMode:i,getScrollTarget:u,setDocumentTitle:a}}),function(t,e){"function"==typeof define&&define.amd?define("js/Config",["jquery","./Util"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("./Util")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.Config=e(t.jQuery,t.PastPresentFuture.Util))}(window,function(t,e){function r(e){u=t.extend({content:".page_content_holder",ajaxContainer:".page_content_holder",prefetchCacheLimit:15,ajaxCacheLimit:15,onParseHtml:!1},e)}function n(t,e){u[t]=e}function i(t){return t=t||!1,t?t in u?u[t]:null:u}var u={};return{init:r,set:n,get:i}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/PushState",["jquery","./Util"],function(r,n){return e(t,r,n)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.PushState=e(t,t.jQuery,t.PastPresentFuture.Util))}(window,function(t,e,r){"use strict";function n(){s.on("PastPresentFuture:AfterInitState",i).on("PastPresentFuture:PushState",u)}function i(){var t=r.getScrollTarget();a.hasClass("initial-load")?a.removeClass("initial-load"):o.stop().animate({scrollTop:t},200)}function u(n,i){i=e.extend({options:{url:i.url},title:""},i),"traditional"===r.getMode()?t.location=i.url:(t.history.pushState(i.options,i.title,i.url),s.trigger("PastPresentFuture:NewState"))}var a=e("html"),o=e("html, body"),s=e(t);return{init:n,pushState:u}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Loading",["jquery","./Util"],function(r,n){return e(t,r,n)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.Loading=e(t,t.jQuery,t.PastPresentFuture.Util))}(window,function(t,e,r){function n(){a.on("PastPresentFuture:LoadingReveal",i).on("PastPresentFuture:LoadingComplete",u)}function i(){o.addClass("is-loading-ajax")}function u(){o.removeClass("is-loading-ajax")}var a=e(t),o=e("html");return{init:n}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Ajax",["jquery","./Util","./Config"],function(r,n,i){return e(t,r,n,i)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.Ajax=e(t,t.jQuery,t.PastPresentFuture.Util,t.PastPresentFuture.Config))}(window,function(t,e,r,n){"use strict";function i(t){if(!(!1 in(t=t||{}))){var r=e.extend({data:{},dataType:"html",disableAfterSuccess:!1,timeout:2e4,type:"get"},t);P=t,r.error=u,r.success=a,r.beforeSend=function(t){t.requestUrl=r.url},e.ajax(r)}}function u(t,e,r){!1 in P||P.error(t,e,r)}function a(t,e,r){t.length<c&&(c=t.length),!1 in P||P.success(t,e,r)}function o(t){var r=n.get("content"),i=n.get("onParseHtml"),u=e(e.parseHTML(t,document,!0));return u=u.filter(r).add(u.find(r)),e.isFunction(i)?i(u):u}function s(t){return t=e.parseHTML(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],document,!0),e(t).filter("title").last().text()}function l(r){return e.grep(r.find("a"),function(r,n){var i=e(r),u=i.attr("href")||"";return"#"!==u.substr(0,1)&&("_blank"!==i.attr("target")&&(-1===u.indexOf("mailto:")&&-1===u.indexOf("javascript:")&&(-1===u.indexOf("//")||-1!==u.indexOf(t.location.hostname))))})}function f(t){var r=l(t);return e.each(r,function(){e(this).on("click.PastPresentFuture",function(t){if(2===t.which||t.metaKey)return!0;var r=e(this),n=r.attr("href");d.trigger("PastPresentFuture:GotoUrl",[n,{url:n,options:{scrollPos:parseInt(e(document).scrollTop(),10),scrollTarget:r.data("scroll-target"),url:n}}]),t.preventDefault()}).addClass("ajax-initialized")}),t}var c=0,d=e(t),P=null;return{loadAjax:i,parseHtml:o,parseTitle:s,ajaxifyLinks:f}}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("js/Manager",["jquery","./Util","./Config","./Ajax"],function(r,n,i,u){return e(t,r,n,i,u)}):"object"==typeof exports?module.exports=e(t,require("jquery"),require("./Util"),require("./Config"),require("./Ajax")):(t.PastPresentFuture=t.PastPresentFuture||{},t.PastPresentFuture.Manager=e(t,t.jQuery,t.PastPresentFuture.Util,t.PastPresentFuture.Config,t.PastPresentFuture.Ajax))}(window,function(t,e,r,n,i){"use strict";function u(){y||(q=r.getMode(),S.limit=n.get("prefetchCacheLimit"),L.limit=n.get("ajaxCacheLimit"),l(),m.length&&(a(),o({isInitLoad:!0}),j(),y=!0))}function a(){"traditional"!==q&&(i.ajaxifyLinks(U),v.on("popstate",function(e){C||t.location.hash||(v.trigger("PastPresentFuture:PopState",e),d(r.currentStateUrl(),{popstate:!0}))}))}function o(t){t=t||{},t=e.extend({isInitLoad:!1,title:document.title},t),t.isInitLoad||(r.setDocumentTitle(t.title),l(),v.trigger("PastPresentFuture:RecordPageview",{url:r.currentStateUrl(),title:t.title})),s(),v.trigger("PastPresentFuture:AfterInitState")}function s(){"traditional"!==q&&e("a[data-prefetch]").each(function(t){var n=e(this).attr("href");n!==r.currentStateUrl()&&setTimeout(function(){g(n)},50*(t+1))})}function l(){m=e(n.get("content")).first(),x=e(n.get("ajaxContainer")).first(),n.get("content")!==n.get("ajaxContainer")&&v.trigger("PastPresentFuture:BeforeTransition",{contentHolder:m,ajaxContainer:x})}function f(t,e){e.prevBodyClasses=U.attr("class"),e.pageConfig=e.data.attr("data-page-config"),x.html(e.data.html()),i.ajaxifyLinks(x),U.removeClass().addClass(e.classes),n.get("content")!==n.get("ajaxContainer")?v.trigger("PastPresentFuture:AnimateTransition",e):o(e)}function c(t){t?v.trigger("PastPresentFuture:LoadingReveal"):v.trigger("PastPresentFuture:LoadingComplete")}function d(n,i){function u(t,r){r.url===n&&(i.popstate||v.trigger("PastPresentFuture:PushState",i),v.trigger("PastPresentFuture:RenderUrl",r),c(!1),e(this).off("PastPresentFuture:FetchedData"))}if(i=i||{},i=e.extend({url:n,popstate:!1},i),t.location.href===r.getAbsoluteUrl(n)&&!i.popstate)return void v.trigger("PastPresentFuture:ResetPage");v.off("PastPresentFuture:FetchedData",u).on("PastPresentFuture:FetchedData",u),"loading"in P({url:n,afterAjaxLoad:function(t,e,r){t=h(L,r.requestUrl,t),v.trigger("PastPresentFuture:FetchedData",t)}})&&c(!0)}function P(t){var e=!0,r={};return(r=p(L.list,t.url))?v.trigger("PastPresentFuture:FetchedData",r):(r=p(S.list,t.url))?v.trigger("PastPresentFuture:FetchedData",r):(r=p(A,t.url))?{loading:!0}:(t.isPrefetch&&(e=!1),A.push({url:t.url}),i.loadAjax({url:t.url,dataType:"html",trackProgress:e,success:t.afterAjaxLoad,error:function(){location.reload(!0)}}),{loading:!0})}function g(t){"traditional"!==q&&P({url:t,isPrefetch:!0,afterAjaxLoad:function(e){F(t),e=h(S,t,e),v.trigger("PastPresentFuture:FetchedData",e)}})}function p(t,e){var r=!1;if(!t.length)return r;for(var n=0;n<t.length;n++)if(t[n].url===e){r=t[n];break}return r}function h(t,r,n){var u={url:r,title:i.parseTitle(n),data:i.parseHtml(n),classes:n.match(/body\sclass=['|"]([^'|"]*)['|"]/)[1]};return t.list.push(u),t.list.length>t.limit&&(t.list=e.grep(t.list,function(t,e){return 0!==e})),u}function F(t){A=e.grep(A,function(e,r){return e.url!==t})}function j(){v.on("PastPresentFuture:GotoUrl",function(t,e,r){C=!1,d(e,r)}).on("PastPresentFuture:RenderUrl",f).on("PastPresentFuture:InitState",function(t,e){o(e)})}var m,x,y=!1,q=(t.history,"traditional"),v=e(t),U=e("body"),C=!0,S={list:[],limit:null},L={list:[],limit:null},A=[];return{init:u}}),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("js/Index",["./Util","./Config","./PushState","./Loading","./Ajax","./Manager"],e);else if("object"==typeof exports)module.exports=e(require("./Util"),require("./Config"),require("./PushState"),require("./Loading"),require("./Ajax"),require("./Manager"));else{var r=t.PastPresentFuture;t.PastPresentFuture=e(r.Util,r.Config,r.PushState,r.Loading,r.Ajax,r.Manager)}}(window,function(t,e,r,n,i,u){"use strict";function a(t){t=t||!1,e.init(t),r.init(),n.init(),u.init()}var o=a.prototype;return o.Util=t,o.Config=e,o.PushState=r,o.Loading=n,o.Ajax=i,o.Manager=u,a});